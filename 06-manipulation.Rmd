---
title: "Manipulación de datos"
author: "Pablo Haya"
output: 
  ioslides_presentation:
      widescreen: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Importamos los datos

Empleamos la funcion `load()` para cargar la tabla que habíamos preparado en el tema anterior.

```{r, echo = TRUE}
library(tidyverse)
load(here("data","core_dataset_clean.RData"))
```

## Filtrar

El verbo `filter()` permite quedarse un subconjunto de las filas de un tabla.

```{r, echo = TRUE}
filter(df, MaritalDesc == "Single")
```

---

Es posible combinar más de un filtro separando las nuevas condiciones por comas.

```{r, echo = TRUE}
filter(df, MaritalDesc == "Single", Age < 30)
```

---

Se pueden incluir operadores lógicos para realizar condiciones más complejas. 

```{r, echo = TRUE}
filter(df, (MaritalDesc == "Single" | Age < 30) & Sex == "Male")
```

## Operador _pipe_

Un operador muy útil que permite encadenar distintas manipulaciones es `%>%`. Este operador índica el flujo de datos de manera que la salida de una operación se emplea como entrada de la siguente.

```{r cars, echo = TRUE}
df %>% filter(MaritalDesc == "Single") %>% filter(Age < 30)
```

## Seleccionar

El verbo `select()` devuelve una nueva tabla con las columnas seleccionadas. 

```{r cars, echo = TRUE}
df %>% filter(MaritalDesc == "Single") %>% 
       filter(Age < 30) %>%
       select(EmployeeName, State, MaritalDesc, Age)
```

--

Se puede emplear `contains()` para obtener los columnas que compartan nombre.

```{r cars, echo = TRUE}
df %>% filter(MaritalDesc == "Single") %>% 
       filter(Age < 30) %>%
       select(contains("Name"), State)
```

## Ordenar

El verbo `arrange()` ordena la tabla según las columnas que se le indiquen.

```{r cars, echo = TRUE}
df %>% filter(MaritalDesc == "Single") %>% 
       filter(Age < 30) %>%
       select(State, Age, MaritalDesc) %>%
       arrange(Age, State)
```

---

Mediante `desc()` es posible cambiar el criterio de ordenación de manera que ordene mayor a menor, en vez de de la ordenación por defecto que es ascendente. 

```{r cars, echo = TRUE}
df %>% filter(MaritalDesc == "Single") %>% 
       filter(Age < 30) %>%
       select(State, Age, MaritalDesc) %>%
       arrange(desc(Age), State)
```

## Modificar 

El verbo `mutate()` permite añadir nuevas variables a la tabla.

```{r, echo = TRUE}
df %>% mutate(Datesofhire = as.Date(Datesofhire, format="%m/%d/%Y")) %>%
       mutate(Days = Sys.Date() - Datesofhire) %>%
       select(Age, Days)
```

## Todo Join



### Referencias

* [Dataset](https://www.kaggle.com/rhuebner/human-resources-data-set)
* [Cadenas de caracteres](https://www.rdocumentation.org/packages/stringr/versions/1.3.1)
* [Fechas](https://www.statmethods.net/input/dates.html)
